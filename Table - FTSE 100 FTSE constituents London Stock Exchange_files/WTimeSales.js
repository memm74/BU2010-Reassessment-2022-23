var fdc__widgets__="object"==typeof fdc__widgets__?fdc__widgets__:{};fdc__widgets__.WTimeSales=(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{114:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var a=i(13),s=i(10);function r(e,t){Object(s.a)(2,arguments);var i=Object(a.a)(e),r=Object(a.a)(t),n=i.getTime()-r.getTime();return n<0?-1:n>0?1:n}},120:function(e,t,i){"use strict";var a=i(219);t.a={data:()=>({currentLeft:null,rendererFids:{countryFlag:{field:"q._COUNTRY",fids:["q._COUNTRY"]},compactDateTime:{fids:["q._TRDTIM_1","q._TRADE_DATE"]},bidOrIndAuc:{fids:["q._BID","q.IND_AUC","q.RDN_EXCHD2","q.PERIOD_CDE","q.PERIOD_CD2"]},askOrIndAuc:{fids:["q._ASK","q.IND_AUC","q.RDN_EXCHD2","q.PERIOD_CDE","q.PERIOD_CD2"]}}}),methods:{resolveFids(e){let t=[];return e.forEach(e=>{e.renderer?this.rendererFids[e.renderer]&&t.push(...this.rendererFids[e.renderer].fids):t.push(e.field)}),t},onClick(e){this.$emit("click",e)},resolveField(e){return this.rendererFids[e]?this.rendererFids[e].field:void 0},valueFormatter(e){if(e.value){const t=e.colDef.field;switch(e.colDef.type?e.colDef.type.split(".")[0]:"string"){case"string":return this.fieldValueTranslations(e,t);case"float":return"q._TURNOVER"===t?this.$f(e.value,"float.compact"):this.$f(e.value,e.colDef.type);case"int":return"q._ACVOL_1"===t?this.$f(e.value,"float.compact"):this.$f(e.value,e.colDef.type);case"datetime":case"date":return this.$f(e.value,e.colDef.type);case"time":return this.formatTime(e.value);default:return e.value}}},fieldValueTranslations(e,t){const i=`${this.wid}Widget.fieldValueTranslations['${t}'].${e.value.trim()}`,a=`${this.wid}Widget.fieldValueTranslations['${t}'].default`;return this.$te(i,this.locale)||this.$te(i,"en")?this.$t(i):this.$te(a,this.locale)||this.$te(a,"en")?this.$t(a):e.value},formatTime(e){if(e&&"-"!==e&&":"!==e.trim()){let t=(new Date).toJSON().split("T")[0];t=t.replace(/-/g,"/");const i=new Date(`${t} ${e} UTC`),a=3===e.split(":").length;return this.$f(i,a?"time.hms":"time.hm")}return"-"},compactDateTime(e){return e.data["q._TRADE_DATE"]&&(e.data["q._TRADE_DATE"]=e.data["q._TRADE_DATE"].trim()),e.data["q._TRDTIM_1"]&&(e.data["q._TRDTIM_1"]=e.data["q._TRDTIM_1"].trim()),e.data["q._TRDTIM_1"]&&"-"!==e.data["q._TRDTIM_1"]&&":"!==e.data["q._TRDTIM_1"]&&e.data["q._TRADE_DATE"]===Object(a.a)(new Date,"dd MMM yyyy").toUpperCase()||!e.data["q._TRADE_DATE"]||"-"===e.data["q._TRADE_DATE"]?this.formatTime(e.data["q._TRDTIM_1"]):this.$f(e.data["q._TRADE_DATE"],"date")},tabToNextHeader(e){if(!e.nextHeaderPosition)return!1;{const t=this.gridOptions.api.rowRenderer.columnApi.getAllDisplayedColumns();let i=[],a=0,s=0;if(!1===e.nextHeaderPosition.column.colDef.sortable||void 0===e.nextHeaderPosition.column.colDef.sortable)if(t.forEach(t=>{!0===t.colDef.sortable&&(e.previousHeaderPosition.column.colId===t.colId&&(s=a),t.order=a,i.push(t),a++)}),1===i.length){if(e.previousHeaderPosition.column.colId===i[0].colId)return!1;e.nextHeaderPosition.column=i[0]}else e.backwards?e.nextHeaderPosition.column=i[s-1]:e.nextHeaderPosition.column=i[s+1];if(void 0!==e.nextHeaderPosition.column)return e.nextHeaderPosition}},addHeaderLabelForSortColumns(e){const t=e.$el.getElementsByClassName("ag-header-cell-sortable");t.length>0&&Array.from(t).forEach(e=>{e.setAttribute("aria-label",e.innerText+" "+this.i18n("header.sortable"))})},tabOutOfGrid(e){this.gridOptions.api?this.gridOptions.api.clearFocusedCell():this.$el.activeElement.blur(),e.backwards&&this.$el.getElementsByClassName("ag-header-cell")[0].focus()},setGridRowHeight(e,t){this.gridOptions.api&&(-1===e?(t&&!Object.values(this.$refs[t].classList).includes("row-auto-height")&&this.$refs[t].classList.add("row-auto-height"),this.gridOptions.api.resetRowHeights()):(t&&Object.values(this.$refs[t].classList).includes("row-auto-height")&&this.$refs[t].classList.remove("row-auto-height"),this.gridOptions.api.forEachNode((function(t){t.setRowHeight(e)})),this.gridOptions.api.onRowHeightChanged()))},setHeightForGrid(e){this.$refs[e].classList.remove("auto-height"),this.gridOptions.api.setDomLayout("autoHeight");const t=this.$refs[e].querySelector(".ag-root-wrapper").scrollHeight,i=parseFloat(getComputedStyle(this.$refs[e]).paddingTop)+parseFloat(getComputedStyle(this.$refs[e]).paddingBottom);t>this.$refs[e].clientHeight-i?this.gridOptions.api.setDomLayout("normal"):this.$refs[e].classList.add("auto-height")},displayFullContent(e,t,i){let a=i?e.event.srcElement:e.srcElement;if((0===a.childElementCount||t)&&null!==a){for(;!a.classList.contains("ag-cell")&&!a.classList.contains("ag-header-cell");)if(a=a.parentElement,null===a)return;a.parentElement&&(a.classList.contains("ag-cell-wrap-text")?this.displayVerticalOverFlow(a):this.displayHorizontalOverflow(a))}},displayHorizontalOverflow(e){this.displayOriginalView();let t={"padding-left":getComputedStyle(e,null)["padding-left"],"padding-right":getComputedStyle(e,null)["padding-right"]};const i=this.getWidthOfFullView(e.textContent.trim(""),t,getComputedStyle(e,null)["font-family"],getComputedStyle(e,null)["font-size"],getComputedStyle(e,null)["font-weight"]);e.clientWidth<i+1&&(this.currentLeft=parseFloat(getComputedStyle(e,null).left),this.expandHorizontally(e,i))},onCellClick(e,t){"button"!==e.colDef.type&&("button"===e.event.srcElement.localName?this.onClick({ric:t,origin:e.event,gridContext:e,button:{class:e.event.srcElement.getAttribute("class")}}):this.onClick({ric:t,origin:e.event,gridContext:e})),this.displayFullContent(e,null,!0)},onCellkeyDown(e,t){const{event:i}=e,{keyCode:a}=i;if(13===a||32===a)if("button"===e.colDef.type){const{buttons:a}=e.colDef;for(let s=0;s<a.length;s++)this.onClick({ric:t,origin:i,button:a[s],gridContext:e})}else this.onClick({ric:t,origin:i,gridContext:e})},expandHorizontally(e,t){let i,a;const s=parseFloat(e.parentElement.parentElement.parentElement.scrollWidth);i=this.currentLeft,a=i+t,a>s&&(i-=a-s+(e.classList.contains("ag-cell")?5:10)),e.style.left=i+"px",e.classList.add("display-full-content"),e.parentElement.style["z-index"]=1},displayVerticalOverFlow(e){if(e.scrollHeight-parseFloat(getComputedStyle(e,null).paddingTop)-parseFloat(getComputedStyle(e,null).paddingBottom)>e.clientHeight){let t;null!==e.parentElement.previousSibling&&null!==e.parentElement.nextSibling?t=-(e.scrollHeight-e.clientHeight)/2:null===e.parentElement.nextSibling&&(t=-(e.scrollHeight-e.clientHeight)),e.style.top=t+"px",e.parentElement.style["z-index"]=1,e.classList.add("display-full-content-wrap")}},displayOriginalView(){const e=this.$el.querySelector(".display-full-content"),t=this.$el.querySelector(".display-full-content-wrap");e&&(e.classList.remove("display-full-content"),e.style.left=this.currentLeft+"px",e.parentElement.style["z-index"]=0),t&&(t.style.top="0px",t.classList.remove("display-full-content-wrap"),t.parentElement.style["z-index"]=0)},getWidthOfFullView(e,t,i,a,s){let r=document.createElement("div");r.innerHTML=e,r.style.left="-99in",r.style.position="absolute",r.style.whiteSpace="nowrap",r.style["font-family"]=i,r.style["font-size"]=a,r.style["font-weight"]=s,Object.keys(t).forEach(e=>{r.style[e]=t[e]}),document.body.appendChild(r);const n=r.clientWidth;return document.body.removeChild(r),n},getPinnedDirection(e,t){switch(e.pinned){case"true":case!0:case"start":e.pinned=t?"right":"left";break;case"end":e.pinned=t?"left":"right";break;default:e.pinned=void 0}return e}}}},152:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));const a={positive:e=>e.data&&e.data.change?+e.data.change>0:e.value>0||"up"===e.value,neutral:e=>e.data&&e.data.change?0==+e.data.change:0===e.value||"right"===e.value,negative:e=>e.data&&e.data.change?+e.data.change<0:e.value<0||"down"===e.value}},187:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var a=i(6);function s(e){let t=Object(a.N)(e);return delete t.width,t}},204:function(e,t,i){"use strict";i.d(t,"b",(function(){return n}));var a=i(5);i.d(t,"c",(function(){return a.default}));var s=i(39),r=i.n(s);function n(e){return void 0===e&&(e={}),Object(s.createDecorator)((function(t,i){(t.props||(t.props={}))[i]=e}))}i.d(t,"a",(function(){return r.a}))},268:function(e,t,i){"use strict";var a=function(){var e=this.$createElement;this._self._c;return this._m(0)};a._withStripped=!0;var s={name:"v-spinner",props:{label:{type:String}}},r=i(7),n=Object(r.a)(s,a,[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"loader"},[t("div",{staticClass:"block"},[t("div",{staticClass:"item"}),this._v(" "),t("div",{staticClass:"item"}),this._v(" "),t("div",{staticClass:"item"}),this._v(" "),t("div",{staticClass:"item"}),this._v(" "),t("div",{staticClass:"item"}),this._v(" "),t("div",{staticClass:"item"}),this._v(" "),t("div",{staticClass:"item"}),this._v(" "),t("div",{staticClass:"item"})])])}],!1,null,null,null);t.a=n.exports},39:function(e,t,i){"use strict";
/**
  * vue-class-component v6.3.2
  * (c) 2015-present Evan You
  * @license MIT
  */Object.defineProperty(t,"__esModule",{value:!0});var a,s=(a=i(5))&&"object"==typeof a&&"default"in a?a.default:a,r="undefined"!=typeof Reflect&&Reflect.defineMetadata;function n(e,t,i){(i?Reflect.getOwnMetadataKeys(t,i):Reflect.getOwnMetadataKeys(t)).forEach((function(a){var s=i?Reflect.getOwnMetadata(a,t,i):Reflect.getOwnMetadata(a,t);i?Reflect.defineMetadata(a,s,e,i):Reflect.defineMetadata(a,s,e)}))}var o={__proto__:[]}instanceof Array;var l=["data","beforeCreate","created","beforeMount","mounted","beforeDestroy","destroyed","beforeUpdate","updated","activated","deactivated","render","errorCaptured"];function d(e,t){void 0===t&&(t={}),t.name=t.name||e._componentTag||e.name;var i=e.prototype;Object.getOwnPropertyNames(i).forEach((function(e){if("constructor"!==e)if(l.indexOf(e)>-1)t[e]=i[e];else{var a=Object.getOwnPropertyDescriptor(i,e);void 0!==a.value?"function"==typeof a.value?(t.methods||(t.methods={}))[e]=a.value:(t.mixins||(t.mixins=[])).push({data:function(){var t;return(t={})[e]=a.value,t}}):(a.get||a.set)&&((t.computed||(t.computed={}))[e]={get:a.get,set:a.set})}})),(t.mixins||(t.mixins=[])).push({data:function(){return function(e,t){var i=t.prototype._init;t.prototype._init=function(){var t=this,i=Object.getOwnPropertyNames(e);if(e.$options.props)for(var a in e.$options.props)e.hasOwnProperty(a)||i.push(a);i.forEach((function(i){"_"!==i.charAt(0)&&Object.defineProperty(t,i,{get:function(){return e[i]},set:function(t){e[i]=t},configurable:!0})}))};var a=new t;t.prototype._init=i;var s={};return Object.keys(a).forEach((function(e){void 0!==a[e]&&(s[e]=a[e])})),s}(this,e)}});var a=e.__decorators__;a&&(a.forEach((function(e){return e(t)})),delete e.__decorators__);var d,c,u=Object.getPrototypeOf(e.prototype),h=u instanceof s?u.constructor:s,g=h.extend(t);return function(e,t,i){Object.getOwnPropertyNames(t).forEach((function(a){if("prototype"!==a){var s=Object.getOwnPropertyDescriptor(e,a);if(!s||s.configurable){var r,n,l=Object.getOwnPropertyDescriptor(t,a);if(!o){if("cid"===a)return;var d=Object.getOwnPropertyDescriptor(i,a);if(r=l.value,n=typeof r,null!=r&&("object"===n||"function"===n)&&d&&d.value===l.value)return}0,Object.defineProperty(e,a,l)}}}))}(g,e,h),r&&(n(d=g,c=e),Object.getOwnPropertyNames(c.prototype).forEach((function(e){n(d.prototype,c.prototype,e)})),Object.getOwnPropertyNames(c).forEach((function(e){n(d,c,e)}))),g}function c(e){return"function"==typeof e?d(e):function(t){return d(t,e)}}c.registerHooks=function(e){l.push.apply(l,e)},t.default=c,t.createDecorator=function(e){return function(t,i,a){var s="function"==typeof t?t:t.constructor;s.__decorators__||(s.__decorators__=[]),"number"!=typeof a&&(a=void 0),s.__decorators__.push((function(t){return e(t,i,a)}))}},t.mixins=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s.extend({mixins:e})}},652:function(e){e.exports=JSON.parse('{"en":{"timeSalesWidget":{"a11y":{"caption":"Time and Sales widget"},"controls":{"symbol":"RIC","dateFrom":"From","dateTo":"To"},"header":{"time":"Time","ticker":"Ticker","name":"Name","price":"Price","change":"+/-","changePercentage":"%","bid":"Bid","ask":"Ask","histClose":"Hist.Close","volume":"Volume","sortable":"Sortable"},"grid":{"loadingOoo":"Loading...","noRowsToShow":"No Rows To Show"},"messages":{"invalidDate":"Invalid date(s) provided.","futureDate":"A future date was provided.","invalidFromDate":"Start date cannot be greater than the end date.","nodata":"No data available.","error":"There was an error. We will try to get the data again in a few moments..."},"numberFormats":{"compact":["","","","0.0K","00K","000K","0.0M","00M","000M","0.0B","00B","000B","0.0T","00T","000T"]},"dateTimeFormats":{"time":{"hour":"2-digit","minute":"2-digit","second":"2-digit","hour12":true,"hm":{"hour":"2-digit","minute":"2-digit","hour12":true},"hms":{"hour":"2-digit","minute":"2-digit","second":"2-digit","hour12":true}},"date":{"year":"numeric","month":"2-digit","day":"2-digit"}}}},"ar-ye":{"timeSalesWidget":{"formatterLanguage":"en","messageLanguage":"ar-ye","a11y":{"caption":"أداة الوقت والمبيعات"},"controls":{"symbol":"الرمز","dateFrom":"من","dateTo":"إلى"},"header":{"time":"الزمن","ticker":"الرمز","name":"الأسم","price":"السعر","change":"+/-","changePercentage":"نسبة التغيير %","bid":"العرض","ask":"الطلب","histClose":"السعر التاريخي","volume":"الحجم","sortable":"قابل للفرز"},"grid":{"loadingOoo":"جار التحميل...","noRowsToShow":"لا توجد صفوف للعرض"},"messages":{"invalidDate":"تم تقديم تاريخ (تواريخ) غير صالحة.","futureDate":"تم تقديم تاريخ في المستقبل.","invalidFromDate":"لا يمكن أن يكون تاريخ البدء أكبر من تاريخ الانتهاء.","nodata":"لا تتوافر بيانات.","error":"كان هناك خطأ. سنحاول الحصول على البيانات مرة أخرى في غضون لحظات قليلة ..."},"numberFormats":{"compact":["","","","0.0K","00K","000K","0.0M","00M","000M","0.0B","00B","000B","0.0T","00T","000T"]},"dateTimeFormats":{"time":{"hour":"2-digit","minute":"2-digit","second":"2-digit","hour12":true,"hm":{"hour":"2-digit","minute":"2-digit","hour12":true},"hms":{"hour":"2-digit","minute":"2-digit","second":"2-digit","hour12":true}},"date":{"year":"numeric","month":"2-digit","day":"2-digit"}}}},"de-DE":{"timeSalesWidget":{"a11y":{"caption":"Time and Sales widget"},"controls":{"symbol":"RIC","dateFrom":"von","dateTo":"zu"},"header":{"time":"Zeit","ticker":"Ticker","name":"Name","price":"Preis","change":"+/-","changePercentage":"%","bid":"Bieten","ask":"Fragen","histClose":"Hist.Close","volume":"Volumen","sortable":"Sortierbar"},"grid":{"loadingOoo":"Wird geladen...","noRowsToShow":"Keine Zeilen zu zeigen"},"messages":{"invalidDate":"Ungültige Daten angegeben.","futureDate":"Ein zukünftiger Termin wurde angegeben.","invalidFromDate":"Das Startdatum darf nicht größer als das Enddatum sein.","nodata":"Für diesen Austausch sind keine Daten verfügbar. Wahrscheinlich zu diesem Zeitpunkt nicht in Betrieb.","error":"Es gab einen Fehler. Wir werden versuchen, die Daten in wenigen Augenblicken erneut abzurufen ..."},"numberFormats":{"compact":["","","","0.0Tsd","00Tsd","000Tsd","0.0Mio","00Mio","000Mio","0.0Mrd","00Mrd","000Mrd","0.0Bn","00Bn","000Bn"]},"dateTimeFormats":{"time":{"hour":"2-digit","minute":"2-digit","second":"2-digit","hour12":false,"hm":{"hour":"2-digit","minute":"2-digit","hour12":false},"hms":{"hour":"2-digit","minute":"2-digit","second":"2-digit","hour12":false}},"date":{"year":"numeric","month":"2-digit","day":"2-digit"}}}}}')},669:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var a=i(13),s=i(10);function r(e){return Object(s.a)(1,arguments),Object(a.a)(e).getTime()>Date.now()}},86:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));const a=["ar","fa","he","ur"],s=/^([a-zA-Z]*)([_\-a-zA-Z]*)$/,r=function(e="en-US"){const t=function(e){const t=s.exec(e);return null!=t&&t[1].toLowerCase()}(e);return-1!=a.indexOf(t)}},979:function(e,t,i){"use strict";i.r(t),i.d(t,"init",(function(){return A}));var a=i(5),s=(i(130),i(64)),r=i(68),n=i(65),o=i(66),l=i(985),d=i(984),c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"widget-breakpoint-directive",rawName:"v-widget-breakpoint-directive:config",value:e.breakpoints,expression:"breakpoints",arg:"config"}],class:"fdc-widget fdc-widget-wrapper time-sales-widget "+e.theme,attrs:{role:"region"}},[i("w-body",{class:e.theme+" widget-body",attrs:{wid:e.wid,ric:e.ric,timeRange:e.timeRange,columns:e.columns,tableRowHeight:e.tableRowHeight,locale:e.locale}})],1)};c._withStripped=!0;var u=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"resize",rawName:"v-resize:debounce.30",value:e.onResize,expression:"onResize",arg:"debounce",modifiers:{30:!0}}],staticClass:"widget-body w-time-sales-widget",attrs:{id:"w-time-sales-widget"}},[e.isError?e.isError&&1!=e.isError?i("div",{staticClass:"p-3 v-error-message",attrs:{"border-variant":"light",align:"center"}},[e._v("\n    "+e._s(e.i18n("messages."+e.isError))+"\n  ")]):i("div",{staticClass:"p-3 v-error-message",attrs:{"border-variant":"danger","header-border-variant":"danger",align:"center"}},[e._v("\n    "+e._s(e.i18n("messages.error"))+"\n  ")]):i("v-container",{staticClass:"h-100 grid-wrap",attrs:{fluid:""}},[i("v-row",{staticClass:"h-100"},[i("v-col",[i("ag-grid-vue",{ref:"timeSalesGrid",staticClass:"c-data-grid ag-theme-balham",attrs:{modules:e.modules,gridOptions:e.gridOptions,columnDefs:e.columnDefs},on:{gridReady:e.onGridReady,componentStateChanged:e.onGridStateChanged}})],1)],1),e._v(" "),e.isLazyLoading?i("v-spinner"):e._e()],1),e._v(" "),e.isLoading?i("v-loader",{staticClass:"loading-border"}):e._e()],1)};u._withStripped=!0;var h=i(56),g=i(268),m=i(77),p=i.n(m),f=i(6),v=i(187),y=i(9),w=i(67),b=i(120),D=i(152),C=i(170),_=i(171),O=i(237),R=i(669),T=i(114),E=i(86),S={name:"w-time-sales-widget",mixins:[w.a,b.a],components:{VLoader:h.a,VSpinner:g.a,AgGridVue:C.AgGridVue,VCol:f.b,VRow:f.H,VContainer:f.d},directives:{resize:p.a},props:{wid:{type:String,required:!0},ric:{type:Object,required:!0,validator:e=>"string"==typeof e.value&&"string"==typeof e.label},timeRange:{type:Object,required:!1},columns:{type:Array,required:!0},tableRowHeight:{type:Number,required:!0},locale:{type:Object,required:!0}},data(){return{isLoading:!1,isFirstLoad:!1,isError:!1,debounceFunction:null,configChangedHandler:null,isLazyLoading:!1,endOfRangeData:!1,lastTimeStamp:null,pageSize:100,pageSizeMultiplier:1,restRetryCount:0,modules:[_.a],gridSettings:Object(f.O)({context:{instance:this,componentParent:this},suppressNoRowsOverlay:!0,suppressPropertyNamesCheck:!0,rowBuffer:2,enableRtl:Object(E.a)(this.locale.messages),defaultColDef:Object(v.a)({valueFormatter:this.valueFormatter,valueGetter:this.rawTypeValueGetter,sortable:!1,minWidth:70,headerClass:"text-center",cellClass:"text-start",menuTabs:[]}),columnTypes:{string:{cellClass:"text-start"},"string.currency":{minWidth:95},time:{minWidth:70},date:{minWidth:80,headerClass:"text-start",cellClass:"direction-ltr"},datetime:{minWidth:145,headerClass:"text-start",cellClass:"direction-ltr"},int:{minWidth:80,headerClass:"text-end",cellClass:"text-end"},float:{minWidth:80,cellClass:"text-end"},"float.price":{minWidth:80,cellClass:"text-center",headerClass:"text-center",valueFormatter:this.priceFormatter},"float.price.change":{cellClassRules:D.a,cellClass:"text-end",minWidth:70},"float.percentage":{minWidth:50,cellClass:"text-end"},"float.percentage.change":{cellClassRules:D.a,cellClass:"text-end",minWidth:50},custom:{cellClass:"text-center"}},tabToNextCell:this.tabOutOfGrid,tabToNextHeader:this.tabToNextHeader,headerHeight:32,rowHeight:28,onBodyScroll:()=>{this.isScrollEnd()&&(this.isLazyLoading=!0,this.getTimeAndSalesData(this.lastTimeStamp).then(()=>{1===this.pageSizeMultiplier&&(this.isLazyLoading=!1)}).catch(e=>{console.error(e),e.message.indexOf("timeout")>=0&&this.restRetryCount<2?(this.restRetryCount++,this.getTimeAndSalesData(this.lastTimeStamp)):this.isLazyLoading=!1}))}}),formats:{},widgetActive:!0}},computed:{resultsCount(){return this.pageSize*this.pageSizeMultiplier},gridOptions(){return this.gridSettings.options},columnDefs(){let e=/i18n\((.*)\)/s;return this.columns.map(t=>{let i={...t};return e.exec(i.headerName)&&(i.headerName=this.i18n(e.exec(i.headerName)[1])),"custom"===i.type&&"function"==typeof i.renderFunction&&(i.cellRenderer=function(e){return i.renderFunction(e.value,e.data,e.rowIndex)}),this.formats[i.field]&&!i.type&&(i.type=this.formats[i.field]),i=this.getPinnedDirection(i,Object(E.a)(this.locale.messages)),i.autoHeight=!1,i})},fids(){return this.columnDefs.map(e=>e.field)},startDate(){return this.timeRange.toDate&&this.timeRange.fromDate?this.getTime(this.timeRange.toDate):null},endDate(){return this.timeRange.fromDate?this.getTime(this.timeRange.fromDate):this.timeRange.toDate?this.getTime(this.timeRange.toDate):null}},created(){this.debounceFunction=this._.debounce(this.fetch,10),delete this.gridSettings.options.getRowNodeId},mounted(){this.debounceFunction()},watch:{ric(){this.log("Ric updated with:",this.ric),this.debounceFunction()},timeRange(){this.log("Time range updated with:",this.timeRange),this.debounceFunction()},columns(){this.log("Columns updated with:",this.columns),this.debounceFunction()},locale(){this.debounceFunction()},tableRowHeight(e){this.log("watch tableRowHeight"),this.setGridRowHeight(e)}},methods:{onGridReady(e){this.log("GRID: onGridReady");this.$refs.timeSalesGrid.$el.querySelector('[role="grid"]').setAttribute("aria-label",this.i18n("a11y.caption")),this.setGridRowHeight(this.tableRowHeight);const t=this.$refs.timeSalesGrid.$el.querySelector(".ag-root");t.addEventListener("mouseover",this.displayFullContent),t.addEventListener("mouseout",this.displayOriginalView),t.addEventListener("focusin",e=>this.displayFullContent(e,!0)),t.addEventListener("focusout",this.displayOriginalView),t.addEventListener("click",this.displayFullContent)},i18n(e){return this.$t(`${this.wid+"Widget"}.${e}`,this.locale.messages)},onResize(){this.gridOptions.api&&(this.gridOptions.api.sizeColumnsToFit(),this.setGridRowHeight(this.tableRowHeight))},onGridStateChanged(){this.gridOptions.api&&this.gridOptions.api.sizeColumnsToFit()},getTime:e=>new Date(e).getTime(),isScrollEnd(){return!1===this.isLoading&&!1===this.isLazyLoading&&!1===this.endOfRangeData&&this.gridOptions.api.getLastDisplayedRow()+1===this.gridOptions.api.getDisplayedRowCount()&&this.lastTimeStamp>this.getTime(this.endDate)},isInputDatesValid(){const e=this.timeRange.fromDate?new Date(this.timeRange.fromDate):null,t=this.timeRange.toDate?new Date(this.timeRange.toDate):null;return e&&!Object(O.a)(e)||t&&!Object(O.a)(t)?(this.isError="invalidDate",!1):Object(R.a)(e)||Object(R.a)(t)?(this.isError="futureDate",!1):!(Object(T.a)(e,t)>0)||(this.isError="invalidFromDate",!1)},clearGridBeforeFetch(){this.gridOptions.api&&(this.log("Clearing grid"),this.gridOptions.api.clearFocusedCell())},resetFieldsBeforFetch(){this.isLoading=!0,this.isFirstLoad=!0,this.endOfRangeData=!1,this.isError=!1,this.isError=!1,this.gridOptions.api&&this.gridOptions.api.setRowData([])},fetch(){if(this.isInputDatesValid()){this.resetFieldsBeforFetch(),this.log("Fetching time & sales data for:",this.ric.value);const e=this.startDate?this.getTime(this.startDate):null;this.lastTimeStamp=e,this.pageSizeMultiplier=1,this.getTimeAndSalesData(e)}},getTimeAndSalesData(e){let t="";return this.endDate&&(t+=`fromDate=${this.endDate}&`),e&&(t+=`toDate=${e}&`),y.a.Rest.get(`/timeseries/tns?ric=${this.ric.value}&fids=${this.fids}&${t}count=${this.resultsCount}`).then(this.handleRestResponse).catch(e=>{console.error(e),e.message.indexOf("timeout")>=0&&this.restRetryCount<2?(this.restRetryCount++,this.getTimeAndSalesData(this.lastTimeStamp)):this.isLoading=!1})},handleRestResponse(e,t){if(this.log("rest response",e),t)return this.isFirstLoad&&(this.isError=!0,this.isLoading=!1),!1;if(this.restRetryCount=0,0===e.data.data.length)this.isFirstLoad?(this.isError="nodata",this.isLoading=!1):this.endOfRangeData=!0;else{if(this.rowData=this.filterNonTradeRows(e.data.data),this.isFirstLoad){if(0===this.rowData.length)return this.isError="nodata",this.isLoading=!1,!1;this.formats=Object.keys(e.data.metadata).reduce((t,i)=>(t[i.split(".")[1]]=e.data.metadata[i].type,t),{})}let t=[];if(e.data.data.length<this.resultsCount)this.endOfRangeData=!0,t=[...this.rowData];else{const e=0!==this.rowData.length?this.rowData[this.rowData.length-1][0]:null;t=this.rowData.filter(t=>t[0]!==e);const i=this.isFirstLoad?20:5;if(t.length<i&&!0===this.widgetActive&&this.pageSizeMultiplier<25)return this.pageSizeMultiplier+=5,this.log("Not enough unique records obtained. Retrying API call for",this.pageSize*this.pageSizeMultiplier,"records."),this.getTimeAndSalesData(this.lastTimeStamp),!1;this.pageSizeMultiplier=1,this.lastTimeStamp=e}this.gridOptions.api&&(this.isFirstLoad?(this.isFirstLoad=!1,this.gridOptions.api.setColumnDefs(this.columnDefs),this.gridOptions.api.setRowData(t),this.isLoading=!1):(this.gridOptions.api.applyTransaction({add:t}),this.isLoading=!1,this.isLazyLoading=!1),this.gridOptions.api.sizeColumnsToFit(),this.setGridRowHeight(this.tableRowHeight),this.addHeaderLabelForSortColumns(this.$refs.timeSalesGrid))}},filterNonTradeRows(e){let t=[...e];return this.fids.indexOf("178")>-1&&(t=t.filter(e=>Object.keys(e).indexOf("178")>-1&&"0"!==e[178])),t},rawTypeValueGetter(e){let t=e.colDef.field,i=this.formats[t],a=e.data[t];switch(i){case"int":return parseInt(a);case"float":return isNaN(parseFloat(a))?"-":a;case"time":return a||"-";case"datetime":return a?new Date(+a):"-";default:return a}},priceFormatter(e){if(e.value){let t=e.value.split(".");return t[1]?t[1].length<2&&(e.value+="0"):e.value+=".00",this.$f(e.value,"float.price")}}},beforeDestroy(){this.widgetActive=!1}},L=i(7),F={name:"w-time-sales-wrapper",components:{WBody:Object(L.a)(S,u,[],!1,null,null,null).exports},directives:{WidgetBreakpointDirective:i(70).a},props:{wid:{type:String,required:!0},breakpoints:{type:Object,default:()=>({xs:320,sm:640,md:992,lg:1200,xl:1600})},theme:{type:String,default:"refinitiv-light"}},computed:{API:()=>y.a,ric(){return{label:"RIC",value:this.$store.state.widget[this.wid].ric,placeholder:"search"}},columns(){return this.$store.state.widget[this.wid].columns},timeRange(){return this.$store.state.widget[this.wid].timeRange},tableRowHeight(){return this.$store.state.widget[this.wid].tableRowHeight},locale(){return this.$store.state.widget[this.wid].locale}},methods:{onUpdateRic(e){this.$store.commit(`widget/${this.wid}/RIC_CHANGED`,e)},onUpdateTimeRange(e){this.$store.commit(`widget/${this.wid}/TIME_RANGE_CHANGED`,e)}}},H=Object(L.a)(F,c,[],!1,null,null,null).exports,$={namespaced:!0,state:()=>({ric:"BMWG.DE",columns:[{headerName:"i18n(header.time)",field:"0",cellClass:"direction-ltr",pinned:!0},{headerName:"i18n(header.price)",field:"6"},{headerName:"i18n(header.volume)",field:"178"}],timeRange:{fromDate:"",toDate:""},tableRowHeight:-1,locale:{default:"en",formatter:"en",messages:"en"}}),mutations:{RIC_CHANGED(e,t){e.ric=t},TIME_RANGE_CHANGED(e,t){e.timeRange=t},COLUMNS_CHANGED(e,t){e.columns=t},ROW_HEIGHT_CHANGED(e,t){e.tableRowHeight=t},LOCALE_CHANGED(e,t){let i={};i.default=t.locale,i.formatter=t.formatterLanguage?t.formatterLanguage:i.default,i.messages=t.messageLanguage?t.messageLanguage:i.default,e.locale=i}},actions:{},getters:{LOCALE_DEFAULT:e=>e.locale.default}},x=i(652);a.default.prototype._={debounce:l.a};const A=function(e,t,i,a,l="refinitiv-light"){const c="timeSales",u=new o.a;let h,g=u.getWidgetId(e);u.isWidgetInstancePresent(g)&&u.destroyWidgetInstance(g,"string"==typeof e),i=i||"en";let m={onError:null,onConfigChange:null};const p=[e=>{e.subscribe((e,t)=>{m.onConfigChange&&m.onConfigChange(Object(d.a)(t))})}],f=new s.a(c,$,p),v=f.getStore();f.replaceState(t);const y=new r.a(c,v,i,["en"],x);y.setLocaleMessages(i,a),y.setLocaleAndUpdateStore(i);new Promise(e=>{h=e});g=u.generateWidgetId();const w="theme--"+l,b=u.createVM(g,e,y.getInstance(),v,(function(e){return e(H,{class:[w],attrs:{id:g},props:{wid:c,theme:w}})}),(function(){h(!0)}));return m={...m,...Object(n.a)(c,y)},m.setRic=e=>{b.$store.commit(`widget/${c}/RIC_CHANGED`,e)},m.setColumns=e=>{b.$store.commit(`widget/${c}/COLUMNS_CHANGED`,e)},m.setTimeRange=e=>{b.$store.commit(`widget/${c}/TIME_RANGE_CHANGED`,e)},m.setTableRowHeight=e=>{b.$store.commit(`widget/${c}/ROW_HEIGHT_CHANGED`,e)},m.destroy=function(){u.destroyWidgetInstance(g,!0)},m}}},[[979,1,2,4,3,6]]]);